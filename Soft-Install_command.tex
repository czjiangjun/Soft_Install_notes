\documentclass[10pt,a4paper]{article}

%%%%%%%%%%%%%%%%% CJK 中文版面控制  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\usepackage{CJK} % CTEX-CJK 中文支持                            %
\usepackage{xeCJK} % seperate the english and chinese		 %
%\usepackage{CJKutf8} % Texlive 中文支持                          %
\usepackage{CJKnumb} %中文序号                                   %
\usepackage{indentfirst} % 中文段落首行缩进                      %
%\setlength\parindent{22pt}       % 段落起始缩进量               %
\renewcommand{\baselinestretch}{1.2} % 中文行间距调整            %
\setlength{\textwidth}{16cm}                                     %
\setlength{\textheight}{24cm}                                    %
\setlength{\topmargin}{-1cm}                                     %
\setlength{\oddsidemargin}{0.1cm}                                %
\setlength{\evensidemargin}{\oddsidemargin}                      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath,amsthm,amsfonts,amssymb,bm}          %数学公式
\usepackage{mathrsfs}                                    %英文花体

\usepackage{xcolor}                                        %使用默认允许使用颜色

\usepackage{fontspec} % use to set font
\setCJKmainfont{SimSun}
\XeTeXlinebreaklocale "zh"  % Auto linebreak for chinese
\XeTeXlinebreakskip = 0pt plus 1pt % Auto linebreak for chinese

\usepackage{longtable}                                   %使用长表格

%%%%%%%%%%%%%%%%%%%%%%%%%  参考文献引用 %%%%%%%%%%%%%%%%%%%%%%%%%%%
%%尽量使用 BibTeX(含有超链接，数据库的条目URL即可)                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[numbers,sort&compress]{natbib} %紧密排列             %
\usepackage[sectionbib]{chapterbib}        %每章节单独参考文献   %
\usepackage{hypernat}                                                                         %
\usepackage[bookmarksopen=true,pdfstartview=FitH,CJKbookmarks]{hyperref}              %
\hypersetup{bookmarksnumbered,colorlinks,linkcolor=green,citecolor=blue,urlcolor=red}         %
%参考文献含有超链接引用时需要下列宏包，注意与natbib有冲突        %
%\usepackage[dvipdfm]{hyperref}                                  %
%\usepackage{hypernat}                                           %
\newcommand{\upcite}[1]{\hspace{0ex}\textsuperscript{\cite{#1}}} %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\AtBeginDvi{\special{pdf:tounicode GBK-EUC-UCS2}} %CTEX用dvipdfmx的话，用该命令可以解决      %
%						   %pdf书签的中文乱码问题		      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%  % EPS 图片支持  %%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{graphicx}                                            %
\usepackage{xcolor}                                        %使用默认允许使用颜色
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{document}
%\CJKindent     %在CJK环境中,中文段落起始缩进2个中文字符
\graphicspath{{figure/}}
%
\renewcommand{\abstractname}{\small{\CJKfamily{hei} 摘\quad 要}} %\CJKfamily{hei} 设置中文字体，字号用\big \small来设
\renewcommand{\refname}{\centering\CJKfamily{hei} 参考文献}
%\renewcommand{\figurename}{\CJKfamily{hei} 图.}
\renewcommand{\figurename}{{\bf Fig}.}
%\renewcommand{\tablename}{\CJKfamily{hei} 表.}
\renewcommand{\tablename}{{\bf Tab}.}

%将图表的Caption写成 图(表) Num. 格式
\makeatletter
\long\def\@makecaption#1#2{%
  \vskip\abovecaptionskip
  \sbox\@tempboxa{#1. #2}%
  \ifdim \wd\@tempboxa >\hsize
    #1. #2\par
  \else
    \global \@minipagefalse
    \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
  \fi
  \vskip\belowcaptionskip}
\makeatother

\newcommand{\keywords}[1]{{\hspace{0\ccwd}\small{\CJKfamily{hei} 关键词:}{\hspace{2ex}{#1}}\bigskip}}

%%%%%%%%%%%%%%%%%%中文字体设置%%%%%%%%%%%%%%%%%%%%%%%%%%%
%默认字体 defalut fonts \TeX 是一种排版工具 \\		%
%{\bfseries 粗体 bold \TeX 是一种排版工具} \\		%
%{\CJKfamily{song}宋体 songti \TeX 是一种排版工具} \\	%
%{\CJKfamily{hei} 黑体 heiti \TeX 是一种排版工具} \\	%
%{\CJKfamily{kai} 楷书 kaishu \TeX 是一种排版工具} \\	%
%{\CJKfamily{fs} 仿宋 fangsong \TeX 是一种排版工具} \\	%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\addcontentsline{toc}{section}{Bibliography}

%-------------------------------The Title of The Paper-----------------------------------------%
\title{软件的安装}
%----------------------------------------------------------------------------------------------%

%----------------------The Authors and the address of The Paper--------------------------------%
\author{
\small
%Author1, Author2, Author3\footnote{Communication author's E-mail} \\    %Authors' Names	       %
\small
%(The Address，City Post code)						%Address	       %
}
\date{}					%if necessary					       %
%----------------------------------------------------------------------------------------------%
\maketitle

%-------------------------------------------------------------------------------The Abstract and the keywords of The Paper----------------------------------------------------------------------------%
%\begin{abstract}
%The content of the abstract
%\end{abstract}

%\keywords {Keyword1; Keyword2; Keyword3}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

%----------------------------------------------------------------------------------------The Body Of The Paper----------------------------------------------------------------------------------------%
%Introduction
\textrm{WIEN2k}软件是在\textrm{Linux~}系统下安装、运行的第一原理计算软件，其编译、安装主要参考\textrm{WIEN2k\_Users-Guide}\upcite{WIEN2K-UG_2001}的第\textrm{11}章\textrm{Installation and Dimensioning}。

除了\textrm{Linux}操作系统，编译、安装环境建议如下，(以下括号中的版本号都是我当前使用的版本)：\\
\begin{itemize}
	\item csh或tcsh
	\item intel编译器 (ifort / icc) (版本 13.0.0) + MKL库函数
	\item 2017版需要\textrm{intel\_\textcolor{red}{2015}}及更高版本的编译器和库函数
	\item $\ast$\textrm{VASP}-\textcolor{red}{5.4.4}需要\textrm{intel\_\textcolor{red}{composer\_xe\_2013\_sp1.3.174}}及更高版本的编译器和库函数\\
		否则编译文件\underline{\textcolor{blue}{~wave.f90~}}时会提示:~“\textcolor{red}{指针数组连续未声明}”:\\
		\textcolor{brown}{wave.F(669): error \#8378: Pointer array is not contiguous unless it is declared CONTIGUOUS.$\quad[\mathrm{CPTWFP}]$}\\
		\textcolor{brown}{WUP\%CPTWFP$=>$ W\%CPTWFP(:,:,:,1)}\\
		\textcolor{brown}{-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}\^{}}
\end{itemize}

为了支持mpi版本的WIEN2k，还需要如下支持：
\begin{itemize}
	\item mpi编译器 openmpi (版本 openmpi-1.8.4) 或 mpich (版本 mpich-3.1.4) 
	\item fftw库 (版本 fftw-3.3.4)
\end{itemize}
\textcolor{red}{注意：}以下安装假定系统和环境设置的默认编译器和编译环境为 \textrm{intel} 编译器环境和 \textrm{mkl} 库(即 \~\//.bashrc 中的环境设置为)：

\textcolor{blue}{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# INTEL\_compiler \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\textcolor{blue}{. \underline{/home/soft/intel/Compiler/11.0/083}/bin/intel64/ifortvars\_intel64.sh}

\textcolor{blue}{. \underline{/home/soft/intel/Compiler/11.0/083}/bin/intel64/iccvars\_intel64.sh}

\textcolor{blue}{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# INTEL\_mkl \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\textcolor{blue}{export LD\_LIBRARY\_PATH=\underline{/home/soft/intel/mkl/10.1.2.024}/lib/em64t/:\$LD\_LIBRARY\_PATH}

或者如果直接安装了INTEL编译器完整版

\textcolor{blue}{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# INTEL\_compiler\_mkl \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\textcolor{blue}{source \underline{你的INTEL安装目录}/bin/compilervars.sh intel64}

\section{openmpi的安装：}
tar -xvzf openmpi-1.8.4.tar.gz

cd openmpi-1.8.4

./configure -\/-prefix=\underline{你的MPI安装目录} CC=icc CXX=icpc F77=ifort FC=ifort -\/--enable-static

make \&\& make install

安装完毕后，新增 \~\//.bashrc 中的环境变量设置：

\textcolor{blue}{\#\#\#\#\#\#\#\#\#\#\#\#\#\# OPENMP \#\#\#\#\#\#\#\#\#\#\#}

\textcolor{blue}{export PATH=\underline{你的MPI安装目录}/bin:\$PATH}


\textcolor{red}{注意：}如果安装mpich，操作完全类似

\textcolor{red}{注意：}查看有关mpi本身指向的编译器等信息的命令 \underline{\textcolor{blue}{mpiexec -info}}\\
\textrm{MPI编译器封装的编译器查看命令}:~\underline{\textcolor{blue}{mpif90 --version/-v}~两个命令略有区别}

当\textrm{openmpi}编译器版本过高，会出现报错:\\
\textrm{Rank mismatch between actual argument at (1) and actual argument at (2) (scalar and rank-1)}

\textcolor{red}{\textbf{添加编译选项 -fallow-argument-mismatch}}

参阅\url{https://gcc.gnu.org/gcc-10/porting_to.html}

\textrm{WIEN2k}代码版本很老，用\textrm{gfortran}编译器编译时，建议加入编译选项\textcolor{red}{-fallow-invalid-boz -fallow-argument-mismatch}防止变量传递时出现错误

\textrm{WIEN2k}代码中的交换-相关泛函包含得比较全，如无必要，不要使用\textrm{libxc}库函数的交换-相关泛函(因为\textrm{WIEN2k}代码较老，编译时使用\textrm{libxc}库会出错)

\section{fftw的安装：}
\textcolor{blue}{一般地，\textrm{Intel~}的\textrm{MKL~}自带了\textrm{FFTW~}的库函数，其中
\begin{itemize}
	\item 头文件位于\;\$MKLROOT/include/fftw
	\item 静态\textrm{fortran~}库函数位于\;\$MKLROOT/interfaces/fftw3xf/libfftw3xf\_intel.a
	\item 静态\textrm{c~}库函数位于\;\$MKLROOT/interfaces/fftw3xc/libfftw3xc\_intel.a
\end{itemize}}

\textcolor{purple}{注意:~}\$MKLROOT/include/fftw的文件包括\\
\textcolor{green}{fftw3.f\;\;  fftw3\_mkl.f\;\;   fftw3\_mkl.h\;\;  fftw3-mpi\_mkl.h\;\;  fftw.h \;\;    fftw\_threads.h\;\;  rfftw\_mpi.h \\
	fftw3.h\;\;  fftw3\_mkl\_f77.h\;\;  fftw3-mpi.h\;\;  fftw\_f77.i \;\;      fftw\_mpi.h \;\; rfftw.h  \;\;       rfftw\_threads.h
}\\
因此如果源代码包括 \underline{\textcolor{green}{fftw3.f03\;\; fftw3.h\;\; fftw3-mpi.f03\;\; fftw3-mpi.h}}等这样的文件

\textbf{\textcolor{red}{则必须安装\textrm{fftw~}库函数}}

\textcolor{color}{red}{\textrm{FFTW}有三类库，分别是\textrm{libfftw.lib}(\textrm{double})、\textrm{libfftwf.lib}(\textrm{float})、libfftwl.lib(\textrm{long~double})}

当编译参数有\textrm{-\/-enable-float}就会编译出\textrm{libfftwf.lib}

当编译参数有\textrm{-\/-enable-long-double}就会编译出\textrm{libfftwl.lib}

tar -xvzf fftw-3.3.4.tar.gz

cd fftw-3.3.4

./configure -\/-prefix=\underline{你的FFTW安装目录} CC=icc MPICC=mpicc F77=ifort FC=ifort MPILIBS=-I\underline{你的MPI安装目录}/include -\/-enable-mpi \textcolor{brown}{-\/-enable-threads -\/-enable-sse -\/-enable-sse2}

make \&\& make install

如果要生成\textrm{fftw/fftw\_mpi}动态库，用如下的设置

./configure -\/-prefix=\underline{你的FFTW安装目录} \textcolor{red}{CC=icc CXX=icpc CFLAGS=-fPIC} F77=ifort FC=ifort \textcolor{red}{-\/-enable-shared}\;\;\;\textcolor{violet}{仅出现动态库}

./configure -\/-prefix=\underline{你的FFTW安装目录} CC=icc MPICC=mpicc F77=ifort FC=ifort MPILIBS=-I\underline{你的MPI安装目录}/include -\/-enable-mpi -\/-enable-openmp \textcolor{red}{-\/-enable-shared}

如果要生成包含\textrm{\textcolor{red}{fftw3f/fftw3f\_mpi/\_thread}}等动态库，用如下的设置

./configure -\/-prefix=\underline{你的FFTW安装目录} CC=icc MPICC=mpicc F77=ifort FC=mpif90 MPILIBS=-I\underline{你的MPI安装目录}/include -\/-enable-mpi  -\/-enable-openmp \textcolor{red}{-\/-enable-shared }\textcolor{brown}{ -\/-enable-threads -\/-enable-sse -\/-enable-sse2}

如果用\textcolor{red}{\textrm{gcc/gfortran}}编译器编译

./configure -\/-prefix=\underline{你的FFTW安装目录} \textcolor{red}{CC=gcc MPICC=mpicc F77=gfortran FC=mpif90} MPILIBS=-I\underline{你的MPI安装目录}/include -\/-enable-mpi  -\/-enable-openmp \textcolor{red}{-\/-enable-shared} \textcolor{brown}{-\/-enable-threads -\/-enable-sse -\/-enable-sse2}

如果用\textcolor{red}{\textrm{intelmpi}编译器编译}

./configure -\/-prefix=\underline{你的FFTW安装目录} \textcolor{red}{CC=icc F77=ifort MPICC=mpiicc} MPILIBS=-I\underline{你的MPI安装目录}/include -\/-enable-shared -\/-enable-static -\/-enable-sse -\/-enable-sse2 -\/-enable-avx -\/-enable-avx2 -\/-enable-fma -\/-enable-threads -\/-enable-openmp -\/-enable-mpi

make -j2 \&\& make install

\section{数学库的安装}
\subsection{{\rm LAPACK}和{\rm BLAS}库的安装}
\textrm{LAPACK}可以在\url{https://www.netlib.org/lapack/}下载(\textrm{LAPACK}依赖\textrm{BLAS})，\textrm{LAPACK}的安装依赖\textrm{gcc}和\textrm{openmpi}

\textrm{cp make.inc.example make.inc}

如果采用\textrm{cmake}编译:
\begin{itemize}
	\item \textrm{mkdir Build \&\& cd Build}
	\item \textrm{cmake~.. -DCMAKE\_BUILD\_TYPE=RELEASE~-DBUILD_SHARED_LIBS=ON}
	\item \textrm{make}
\end{itemize}

\textrm{BLAS}库的编译:
\begin{itemize}
	\item  对文件\textrm{make.inc}，对文件倒数第4行做如下更改\\
	\# 更改前\\
	\textrm{BLASLIB      = ../../librefblas.a} \\
\# 更改后\\
\textrm{BLASLIB      = \underline{你的安装目录}/librefblas.a}
\item \textrm{make blaslib}
\end{itemize}
编译\textrm{LAPACK}时要注意务必完全编译完毕(\textrm{make all})，不报错才可以结束

\subsection{编译{\rm blacs}库}
\textrm{BLACS}版本很老，用\textrm{openmpi}(版本号\textrm{1.8.4})或\textrm{mpich}(版本号\textrm{3.1.4})可以编译成功
编译器必须选择\textcolor{red}{\textrm{mpif77}}和\textrm{mpicc}

\subsection{编译{\rm scalapack}库}
\textrm{cp SLmake.inc.example SLmake.inc}
\begin{itemize}
	\item 在文件\textrm{SLmake.inc}中指定\textrm{BLASLIB}和\textrm{LAPACKLIB}
	\item \textrm{make all}
\end{itemize}

\subsection{编译{\rm openblas}}\\
仔细阅读\textrm{README.md}~\textcolor{red}{关于是否使用\textrm{USE_OPENMP=1}选项}\\
	\textrm{make all USE_OPENMP=1}

\subsection{编译{\rm mpiblacs}}
\textcolor{red}{建议用mpich编译，而且版本过老，一般不需要}
仔细阅读\textrm{README.md}%~\textcolor{red}{关于是否使用\textrm{USE_OPENMP=1}选项}
\\编译文件位于\textrm{BMAKES}目录下，选择适当的编译文件(这里选择\textrm{Bmake.MPI-LINUX})，作为编译文件\textrm{Bmake.inc}

\subsection{编译{\rm libxc}}
./configure -\/-prefix=\underline{你的\textrm{libxc}安装目录} -\/-enable-mpi -\/-enable-shared

make \&\& make check \&\& make install

环境变量中加载 %\textrm{libxc}安装目录}/lib:\$LD\_LIBRARY\_PATH
\begin{itemize}
	\item \textrm{export~C\_INCLUDE\_PATH=\$XC/include}
	\item \textrm{export~LIBRARY\_PATH=\$XC/lib}
	\item \textrm{export LD\_LIBRARY_PATH=\$XC/lib}
\end{itemize}

\textrm{cmkake}安装
\begin{itemize}
	\item \textrm{mkdir~Build \&\& cd~build}
	\item cmake ../ -DCMAKE\_BUILD\_TYPE=Release -DCMAKE\_INSTALL\_PREFIX=\$LIBXC \\
-DBUILD\_SHARED\_LIBS=YES -DCMAKE\_C\_COMPILER=gcc \\
-DCMAKE\_Fortran\_COMPILER=gfortran \\
-DCMAKE\_INSTALL\_LIBDIR=lib -DENABLE\_FORTRAN=ON \\
-DENABLE\_CXX=ON -DENABLE\_PYTHON=ON \\
-DBUILD\_TESTING=ON
\end{itemize}
\item make \&\& make install
\subsection{{\rm ATLAS库的安装}}
仔细阅读\textrm{README}和\textrm{INSTALL.txt}\\

\textrm{ATLAS}库必须在特定的目录下安装，不支持\textrm{-\/-prefix=}指定变量安装:\\

\textrm{cd \$ATLAS\_INSTALLED\_PATH}\\ 
配置文件命令:\\
\textrm{\$ATLAS\_SRC\_PATH/configure ~-\/-with-netlib-lapack-tarfile=\$lapack-x.xx.x.tar.gz -\/-shared -\/-cripple-atlas-performance}\\
安装命令:\\
\textrm{make \&\& make~cehck \&\& make~ptcheck \&\& make~time \&\& make~install}

\section{库函数检查的有关命令}
\textbf{nm}

\textcolor{red}{-D或--dynamic}\;\;显示动态符号。该任选项仅对于动态目标(例如特定类型的共享库)有意义

\textcolor{red}{-g或--extern-only}\;\;仅显示外部符号

\textcolor{red}{-u或--undefined-only}\;\;仅显示没有定义的符号(那些外部符号)

\textbf{ldd}

\textbf{ldd}命令用于判断某个可执行的 binary 文件含有什么\textcolor{blue}{动态函式库}

\textcolor{red}{-d --data-relocs}\;\; 执行符号重部署，并报告缺少的目标对象(只对ELF格式适用)

\textcolor{red}{-r --function-relocs}\;\; 对目标对象和函数执行重新部署，并报告缺少的目标对象和函数(只对ELF格式适用)

\textbf{readelf}

\textbf{readelf}命令查看共享库的依赖库(\textrm{NEED})和搜索名(\textrm{SONAME})

\textcolor{red}{-d}\;\;查看动态库的真实名字

\section{\rm{CP2k}的安装}
由\textrm{github}下载最新版的\textrm{CP2k}\\
\textrm{git clone git@github.com:cp2k/cp2k.git}
\subsection{预安装}
进入到目录\textrm{cd tools/toolchain}\\
执行安装命令:\\
\textrm{./install\_cp2k\_toolchain.sh  -\/-with-openmpi=/home/jun-jiang/Softs/openmpi/5.0.0\_gnu -\/-with-libxsmm=install -\/-with-openblas=/home/jun-jiang/.local -\/-with-fftw=/home/jun-jiang/Softs/fftw/3.3.9\_gnu -\/-with-cmake=install -\/-with-libint=no -\/-with-libxc=/home/jun-jiang/.local/libxc/6.2.2 -\/-with-libgrpp=install -\/-with-libxsmm=install -\/-with-scalapack=/home/jun-jiang/.local -\/-with-libvdwxc=install}\\
几个选项
\begin{itemize}
	\item \textrm{-\/-with-openmpi=system}:~这里的\textrm{system}明确为库函数的所在目录
	\item \textrm{-\/-with-cmake=install}:~这里的\textrm{install}是直接在线下载安装，如:\\
		\textrm{wget -\/-quiet https://www.cp2k.org/static/downloads/libint-v2.6.0-cp2k-lmax-5.tgz}\\
		\textrm{libint-v2.6.0-cp2k-lmax-5.tgz: OK}\\
		\textrm{Checksum of libint-v2.6.0-cp2k-lmax-5.tgz Ok}\\
\textrm{Installing from scratch into /home/jun-jiang/Softwares/cp2k/tools/toolchain/install/libint-v2.6.0-cp2k-lmax-5}
	\item \textrm{-\/-with-libint=no}:~这里的\textrm{no}表示不安装
\end{itemize}
\subsection{安装\rm{CP2k}}
\textrm{Now copy:\\
cp /home/jun-jiang/Softwares/cp2k/tools/toolchain/install/arch/* to the cp2k/arch/ directory}
 
\textrm{To use the installed tools and libraries and cp2k version\\
compiled with it you will first need to execute at the prompt:\\
  source /home/jun-jiang/Softwares/cp2k/tools/toolchain/install/setup}

\textrm{To build CP2K you should change directory:\\
cd cp2k/}\\
\textrm{git submodule update -\/-init -\/-recursive}\\
因为 \textrm{ext/dbcsr} 没有更新:~如直接网络链接有问题，可尝试\\
\textrm{git clone https://github.com/cp2k/dbcsr.git}\\
然后再执行\\
\textrm{git submodule update -\/-init -\/-recursive}\\

最后执行\\
\textrm{make -j 2 ARCH=local VERSION="ssmp sdbg psmp pdbg"}

\section{WIEN2k的安装}
选定安装目录(没有则新建一个目录)，将\textrm{WIN2k}安装文件包安放在该目录下。根据\textrm{WIEN2k\_Users-Guide}\upcite{WIEN2K-UG_2001}的第\textrm{11}章\textrm{Installation and Dimensioning}说明，\textrm{WIEN2k}的安装如下：

tar -xvf WIEN2k-version.tar

gunzip *.gz

./expand\_lapw

\textcolor{red}{建议：}新增 \~\//.bashrc 的环境变量设置：

\textcolor{blue}{MKLPATH = \underline{你的\textrm{INTEL\_MKL}库目录}}

接下来的编译安装主要通过脚本 \textrm{siteconfig\_lapw}完成，其中涉及的最重要的编译参数设置如下：

FOPT = \textcolor{red}{-FR -mp1 -w -prec\_div -pc80 -pad -ip -DINTEL\_VML -traceback -assume buffered\_io -DFFTW3 -I\underline{你的FFTW安装目录}/include}

LDFLAGS = \textcolor{red}{\$(FOPT) -L\${MKLPATH} -pthread}

R\_LIBS = \textcolor{red}{-lfftw3\; -lmkl\_lapack95\_lp64\; -lmkl\_intel\_lp64\; -lmkl\_intel\_thread\; -lmkl\_core\; -openmp\; -L\underline{你的FFTW安装目录}/lib\; -lpthread}

RP\_LIBS = \textcolor{red}{-lfftw3\_mpi\; \${MKLPATH}/libmkl\_scalapack\_lp64.a\; -Wl,--start-group\; \${MKLPATH}/libmkl\_sequential.a\; \${MKLPATH}/libmkl\_blacs\_openmpi\_lp64.a\; \${MKLPATH}/libmkl\_core.a\; -Wl,--end-group\/ \$(R\_LIBS)}

\textcolor{red}{特别地}，$\star$对\textrm{LAPW0}的\textrm{mpi}并行：\\
 \textcolor{blue}{RP\_LIBS =-lfftw3\_mpi\; \${MKLPATH}/libmkl\_scalapack\_lp64.a\; -Wl,--start-group\; \${MKLPATH}/libmkl\_sequential.a\; \${MKLPATH}/libmkl\_core.a\; \${MKLPATH}/libmkl\_blacs\_openmpi\_lp64.a\; -Wl,--end-group\/ \$(R\_LIBS)}

\textcolor{red}{注意：}如果是用mpich，将 \textrm{ RP\_LIBS } 中的选项\\
\${MKLPATH}/libmkl\_blacs\_openmpi\_lp64.a 替换为\\
\${MKLPATH}/libmkl\_blacs\_intelmpi\_lp64.a \\
\textcolor{red}{或者}，将 \textrm{ RP\_LIBS } 中的\textrm{RP\_LIBS}选项设置为\\
RP\_LIBS = \textcolor{red}{-lfftw3\_mpi\; -lmkl\_scalapack\_lp64\; -lmkl\_sequential\; -lmkl\_blacs\_intelmpi\_lp64\; \${MKLPATH}/libmkl\_blas95\_lp64.a\; -L\underline{你的MPICH安装目录}/lib\; -lmpich\; -lmpichf90\/ \$(R\_LIBS)}

\section{安装后环境设置}
安装后的环境配置主要通过脚本 \textrm{userconfig\_lapw}完成，我自己选择的文本编辑器是 \textrm{vim}(默认的是 \textrm{emacs} )，其余的都选用默认值。

完成环境配置后，如有必要，还可以通过编辑 \~\//.bashrc 修改有关参数：

\textcolor{red}{注意：}如选用\textrm{mpi}并行版本，建议对 \~\//.bashrc 作下列修改
\begin{itemize}
	\item 注释以下这行：\\
\textcolor{blue}{\#ulimit -s unlimited}
	\item	修改parallel\_options\\
\textcolor{blue}{setenv WIEN\_MPIRUN ``mpirun -machinefile \_HOSTS\_ -np \_NP\_ \_EXEC\_''}
\end{itemize}

\section{配置web界面}
用\textrm{root}用户打开\textrm{apache}服务

service apache2 start

在普通用户下执行

\textrm{w2web}

将打开\textrm{WIEN2k}默认的\textrm{7890}端口作为\textrm{WIEN2k}的\textrm{web}界面

\section{.machines文件的编写}
\textrm{.machines}文件指定了并行计算所使用的计算资源，因此需要平衡计算资源的负载平衡。\textrm{.machines}文件中每一项详细说明参见\textrm{WIEN2k\_Users-Guide}\upcite{WIEN2K-UG_2001}的第\textrm{5}章之\textrm{5.5 Running programs in parallel mode}。
根据\textrm{.machines}文件不同决定进行\textrm{k-point}或\textrm{mpi}并行计算：\\\\
\textrm{k-point}并行的\textrm{.machines}：\\
granularity:1 \\
1:node31:1 \#格式：1:指定节点名:1 (\textrm{k-point}并行方式)\\
1:node31:1 \\
1:node32:1 \\
1:node32:1 \\
lapw0:node31:2 node32:2 \# 指定lapw0并行方式：lapw0:指定节点名:核数 n \\
extrafine:1 \\\\
\textrm{mpi}并行的\textrm{.machines}：\\
granularity:1 \\
1:node31:2 \# 格式：1:指定节点名:核数 n (\textrm{mpi}并行)\\
1:node32:2 \\
lapw0:node31:2 node32:2 \# 指定lapw0并行方式：lapw0:指定节点名:核数 n \\
extrafine:1


\section{采用作业调度提交作业}
在pbs作业管理系统中，手动编辑\textrm{.machines}实现WIEN2k的并行费时费力，这里提供一个脚本(\textrm{wien2k.pbs})可以根据分配的计算资源自动生成\textrm{.machines}。

\textcolor{red}{注意：该脚本使用时需要根据计算环境修改计算参数}\\
cat wien2k.pbs \\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\# \#\\
\# Script for submitting parallel wien2k jobs to Dawning cluster. \#\\
\# \#\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\# Lines that begin with \# PBS are PBS directives (not comments).\\
\# True comments begin with "\# " (i.e., \# followed by a space).\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\#PBS -S /bin/bash\\
\#PBS -N TiO2\\
\#PBS -j oe\\
\#PBS -l nodes=1:ppn=8\\
\#PBS -V\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\# -S: shell the job will run under\\
\# -o: name of the queue error filename\\
\# -j: merges stdout and stderr to the same file\\
\# -l: resources required by the job: number of nodes and processors per node\\
\# -l: resources required by the job: maximun job time length\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
\#\#\#\#\#\#\#\#\# parallel mode is mpi/kpoint \#\#\#\#\#\#\#\#\#\#\#\#\\
PARALLEL=mpi // 表示采用\textrm{mpi}并行或\textrm{k}点并行\\
echo \$PARALLEL\\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\%\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\\
NP=`cat \${PBS\_NODEFILE} | wc -l` \\
NODE\_NUM=`cat \$PBS\_NODEFILE|uniq |wc -l` \\
NP\_PER\_NODE=`expr \$NP / \$NODE\_NUM` \\
username=`whoami` \\
export WIENROOT=\underline{你的WIEN2k安装目录} \\
export PATH=\$PATH:\$WIENROOT:. \\
WIEN2K\_RUNDIR=/scratch/\${username}.\${PBS\_JOBID} \\
export SCRATCH=\${WIEN2K\_RUNDIR} \\
\# creat scratch dir \\
if [ ! -a \$WIEN2K\_RUNDIR ]; then \\
echo "Scratch directory \$WIEN2K\_RUNDIR created." \\
mkdir -p \$WIEN2K\_RUNDIR \\
fi \\
cd \$PBS\_O\_WORKDIR \\
\#\#\#\#\#\#\#\#\# Creating .machines \#\#\#\#\#\#\#\#\#\#\#\# \\
case \$PARALLEL in \\
mpi) \\
echo "granularity:1" $>$ .machines \\
for i in `cat \$PBS\_NODEFILE | uniq ` \\
do \\
echo "1:"\$i":"\$NP\_PER\_NODE $>>$ .machines \\
done \\
printf "lapw0:" $>>$ .machines \\
\#\#\#\#\#\#\#\#\# \textrm{lapw0} 用 \textrm{mpi} 并行 \#\#\#\#\#\#\#\#\#\#\#\# \\
for i in `cat \${PBS\_NODEFILE} | uniq` \\
do \\
printf \$i:\$NP\_PER\_NODE" " $>>$ .machines \\
done \\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# \\
\#\#\#\#\#\#\#\#\# \textrm{lapw0} 用 \textrm{mpi} 并行报错的算例用以下 mpi\_error\_lapw0 \#\#\#\#\#\#\#\#\#\#\#\# \\
\# printf `cat \${PBS\_NODEFILE}| uniq | head -1`:1 $>>$ .machines \\
\#\#\#\#\#\#\#\#\#\#\#\#\# end \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# \\
printf "\\n" $>>$ .machines \\ 
echo "extrafine:1" $>>$ .machines \\
;; \\
kpoint) \\
echo "granularity:1" $>$ .machines \\
for i in `cat \$PBS\_NODEFILE` \\
do \\
echo "1:"\$i":" 1 $>>$ .machines \\
done \\
printf "lapw0:" $>>$ .machines \\
\#\#\#\#\# \textrm{lapw0} 用 \textrm{mpi} 并行 \#\#\#\#\#\#\#\#\#\#\#\#\# \\
for i in `cat \${PBS\_NODEFILE} | uniq` \\
do \\
printf $i:$NP\_PER\_NODE" " $>>$ .machines \\
done \\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# \\
\#\#\#\# \textrm{lapw0} 用 \textrm{mpi} 并行报错的算例用以下 \textrm{mpi\_error\_lapw0} \#\#\#\#\#\#\#\# \\
\# printf `cat \${PBS\_NODEFILE} | uniq | head -1`:1 $>>$ .machines \\
\#\#\#\#\#\#\#\#\#\#\#\#\# end \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# \\
printf "\\n" $>>$ .machines \\
echo "extrafine:1" $>>$ .machines \\
;; \\
esac \\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# end creating \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# \\
\#\#\#\#\#\#\# Run the parallel executable "WIEN2K" \#\#\#\#\#\#\#\#\# \\
instgen\_lapw \\
init\_lapw -b \\
clean -s \\
echo "\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# start time is `date` \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#" \\
run\_lapw -p \\
echo "\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# end time is `date` \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#" \\
rm -rf \$WIEN2K\_RUNDIR \\
\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# END \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#

%一般需要修改的地方已用红字标出
该脚本可以实现算例的初始化，必须在存在*.struct的前提下进行。

\section{\rm{LAMMPS}的安装}
\subsection{前期准备}
在\textrm{Linux}系统中先安装好\textrm{gfortrant}，\textrm{g++}等编译器， 可以利用命令\textrm{<whereis gfortrant>}查看\textrm{Linux}系统中是否安装好了编译器

\subsection{\rm{fftw}安装}

\subsection{串行安装}
先到\textrm{STUBS}目录编译静态库
\begin{itemize}
	\item \textrm{cd~STUBS/}
	\item \textrm{make~clean}
	\item \textrm{make}
	\item \textrm{make all}
\end{itemize}

\subsubsection{子模块检查与安装}
进到\textrm{src}目录下输入\textrm{make}查看\textrm{make}选项，检查安装包
\begin{itemize}
	\item \textrm{make~package-status}~ \# 查看安装包的情况
	\item \textrm{make yes-all}
	\item \textrm{make yes-Name\_of\_Package}~ \#<某个包>
	\item \textrm{make no-all}
	\item \textrm{make no-Name\_of\_Package}~ \#<某个包>
\end{itemize}
通过以上命令来选择需要的包，在安装某个包的时候，最好看下官方文档，查看这个包有什么作用。有些包需要先在\textrm{lammps/lib}目录下编译好，才能被安装成功

\textrm{lammps}包含了非常丰富的\textrm{packages}，大约有60多个，默认开启的是:~
\begin{itemize}
	\item \textrm{KSPACE}
	\item \textrm{MANYBODY}
	\item \textrm{MOLECULE}
\end{itemize}

其他的包，大致分为3类:~
\begin{itemize}
	\item 直接通过\textrm{make~yes}就能安装的包，如\textrm{ASPHERE}、\textrm{BODY}、\textrm{CLASS2}等。
	\item 需要在\textrm{lammps/lib}文件夹下手动编译的包，如\textrm{atc}、\textrm{quip}、\textrm{reaxc}等\\
		\textcolor{red}{比如执行\textrm{make -f Makefile.gfortran}}\\
		\textcolor{blue}{必要时在编译主模块的\textrm{Makefile}文件中指定包的库函数链接}
	\item 需要在\textrm{lammps/lib}文件夹下，额外下载源码安装，然后再链接的包，如\textrm{kim}、\textrm{voronoi}、\textrm{user-quip}等。
\end{itemize}

另外特别指出，还有一些功能可以支持，部分列举如下:~
\begin{itemize}
	\item \textrm{lammps}支持\textrm{GPU}，可以编译出\textrm{GPU}版本(需要\textrm{GPU}编译器)
	\item 安装\textrm{jpeg/png}的库，并通过修改\textrm{lammps}的\textrm{Makefile}来支持
	\item 修改\textrm{lammps}的\textrm{Makefile}的宏定义来支持\textrm{ffmpeg}
	\item 修改\textrm{lammps}的\textrm{Makefile}的宏定义来编译出不同精度的\textrm{lammps}
\end{itemize}

\subsubsection{主模块安装}
修改\textrm{src/MAKE}目录下得\textrm{Makefile.serial}文件，串行\textrm{lammps}只要修改如下几行:
\begin{itemize}
	\item \textrm{FFT\_INC = -DFFT\_FFTW3 -I/<fftw的安装路径>/include}
	\item \textrm{FFT\_PATH = -L/<fftw的安装路径>/lib}
	\item \textrm{ FFT\_LIB = -lfftw3}
\end{itemize}
\textrm{Makefile}文件中一些参数输入修改可以参考\textrm{src/MAKE}目录中\textrm{MACHINES}和\textrm{OPTIONS}目录里的文件。

回到\textrm{src}目录，输入\textrm{make~serial mode=shlib}即可开始安装

\subsubsection{并行版安装}
与串行版类似，只是多了指定\textrm{mpi}编译器的内容

\subsection{配套可视化工具VMD的安装}
\textrm{VMD}需要的工具(\textrm{csh})和库函数(\textrm{libstdc++5})
\begin{itemize}
	\item 下载\textrm{VMD}软件~\textrm{（\url{http://www.ks.uiuc.edu/Research/vmd/}）}\\
		或命令:~\textrm{wget~http://www.ks.uiuc.edu/Research/vmd/vmd-1.9.3/files/final/vmd-1.9.3.bin.LINUXAMD64-CUDA8-OptiX4-OSPRay111p1.opengl.tar.gz}
	\item 解压
	\item 如果必要可以修改\textrm{configure}中的两个参数\\
		\textrm{\$install\_bin\_dir}(默认为\textrm{/usr/local/bin})和\textrm{\$install\_library\_dir}(默认为\textrm{/usr/local/lib/\$install\_name})
	\item 运行命令\textrm{sudo ./configure LINUXAMD64}
	\item 运行命令\textrm{sudo ./configure}
	\item 进入目录\textrm{src}，运行\textrm{sudo~make~install}
\end{itemize}

\subsubsection{\rm{CMAKE}安装的设置(参考)}
%-C (builddir)s/lammps-stable_29Oct2020/cmake/presets/all_off.cmake 
-DCMAKE\_BUILD\_TYPE=Release -DBUILD\_SHARED\_LIBS=on -DPKG\_PYTHON=on \\
-DBUILD\_LIB=on -DCMAKE\_INSTALL\_LIBDIR=\%(installdir)s/lib -DLAMMPS\_EXCEPTIONS=on \\
-DCMAKE\_INSTALL\_PREFIX=\%(installdir)s \\
-DPKG\_ASPHERE=on -DPKG\_BODY=on -DPKG\_CLASS2=on -DPKG\_COLLOID=on \\
-DPKG\_CORESHELL=on -DPKG\_DIPOLE=on -DPKG\_GRANULAR=on -DPKG\_KSPACE=on \\
-DPKG\_MANYBODY=on -DPKG\_MC=on -DPKG\_MISC=on -DPKG\_MOLECULE=on \\
-DPKG\_MPIIO=on -DPKG\_OPT=on -DPKG\_PERI=on -DPKG\_POEMS=on \\
-DPKG\_QEQ=on -DPKG\_REAX=on -DPKG\_REPLICA=on \\
-DPKG\_RIGID=on -DPKG\_SHOCK=on -DPKG\_SNAP=on -DPKG\_SPIN=on -DPKG\_SRD=on \\
-DPKG\_USER-ATC=on \\
-DPKG\_USER-AWPMD=on -DPKG\_USER-BOCS=on -DPKG\_USER-CGDNA=on -DPKG\_USER-CGSDK=on \\
-DPKG\_USER-COLVARS=on -DPKG\_USER-DIFFRACTION=on -DPKG\_USER-DPD=on \\
-DPKG\_USER-DRUDE=on -DPKG\_USER-EFF=on -DPKG\_USER-FEP=on -DPKG\_USER-INTEL=on \\
-DPKG\_USER-LB=on -DPKG\_USER-MANIFOLD=on -DPKG\_USER-MEAMC=on -DPKG\_USER-MESO=on \\
-DPKG\_USER-MGPT=on -DPKG\_USER-MISC=on -DPKG\_USER-MOFFF=on\\
-DPKG\_USER-OMP=yes -DPKG\_USER-PHONON=on -DPKG\_USER-PTM=on -DPKG\_USER-QTB=on \\
-DPKG\_USER-REAXC=on -DPKG\_USER-SMTBQ=on -DPKG\_USER-SDPD=on -DPKG\_USER-SPH=on \\
-DPKG\_USER-TALLY=on -DPKG\_USER-UEF=on \\
-DPKG\_VORONOI=on -DVORO\_LIBRARY=\$EBROOTVOROPLUSPLUS/lib/libvoro++.a \\
-DVORO\_INCLUDE\_DIR=\$EBROOTVOROPLUSPLUS/include/voro++ \\
-DTBB\_LIBRARY=\$EBROOTTBB/tbb/lib/intel64/gcc4.8/libtbb.so \\
-DTBB\_INCLUDE\_DIR=\$EBROOTTBB/tbb/include \\
-DTBB\_MALLOC\_LIBRARY=\$EBROOTTBB/tbb/lib/intel64/gcc4.8/libtbbmalloc.so \\
-DTBB\_MALLOC\_INCLUDE\_DIR=\$EBROOTTBB/tbb/include \\
-DCMAKE\_PREFIX\_PATH=\$EBROOTGSL\_ROOT \\
-DCMAKE\_C\_FLAGS="-I\$EBROOTTBB/tbb/include -qopenmp -qno-openmp-offload \$EBVARCFLAGS" \\
-DCMAKE\_CXX\_FLAGS="-I\$EBROOTTBB/tbb/include -qopenmp -qno-openmp-offload \\
-I\$EBROOTMKL/mkl/lib/intel64/ \$EBVARCXXFLAGS" \\
-DCMAKE\_Fortran\_FLAGS="-I\$EBROOTTBB/tbb/include -qopenmp -qno-openmp-offload \$EBVARFCFLAGS" \\
-DCMAKE\_CXX\_COMPILER=mpicxx -DCMAKE\_C\_COMPILER=mpicc -DPKG\_GPU=ON \\
-DGPU\_API=cuda -DCUDA\_CUDA\_LIBRARY=\$EBROOTCUDA/lib64/stubs/libcuda.so \\
-DGPU\_ARCH="-gencode arch=compute\_60,code=[sm\_60,compute\_60] \\
-gencode arch=compute\_70,code=[sm\_70,compute\_70] \\
-gencode arch=compute\_80,code=[sm\_80,compute\_80]" \\
-DCMAKE\_EXE\_LINKER\_FLAGS="-L\$EBROOTIFORT/lib/intel64 -DINTEL\_ARCH=cpu

测试成功的(参考)
\begin{itemize}
	\item \textrm{tar -xvzf lammps-stable.tar.gz}
	\item \textrm{cd lammps-2Aug2023}
	\item \textrm{mkdir Build \&\& cd Build}
	\item \textrm{cmake ../cmake -D BUILD\_SHARED\_LIBS=yes -D LAMMPS\_EXCEPTIONS=yes  -D PKG\_MANYBODY=yes -D PKG\_RIGID=yes -D PKG\_MOLECULE=yes -D PKG\_KSPACE=yes -D PKG\_MISC=yes -D PKG\_MC=yes  -D PKG\_PYTHON=yes -D PYTHON\_EXECUTABLE=\$(which python3)}
	\item \textrm{cmake -\/-build .}
\end{itemize}

\# 添加\textrm{lammps}可执行文件\textrm{lmp_mpi}的路径:\\
\textrm{export PATH=/home/wsg/software/anaconda3/envs/lammps/bin:\$PATH}\\
\# 添加\textrm{lammps}势文件路径\\
\textrm{export LAMMPS\_POTENTIALS=/home/wsg/software/lammps-29Sep2021/potentials:\$LAMMPS\_POTENTIALS}\\
\# 添加\textrm{lammps}的\textrm{python}文件夹的路径(必需)\\
\textrm{export PYTHONPATH=/home/wsg/software/lammps-29Sep2021/python:\$PYTHONPATH}\\
\#然后下面是\textrm{Anaconda}的\textrm{lammps}环境搜索路径(必需，有\textrm{liblammps.so}和\textrm{libpython.so})\\
\textrm{export LD\_LIBRARY\_PATH=/home/wsg/software/anaconda3/envs/lammps/lib:\$LD\_LIBRARY\_PATH}

\subsection{{\rm LAMMPS}的建模、可视化工具}
\textrm{ovito}安装时提示
\textrm{qt.qpa.plugin:~From 6.5.0, xcb-cursor0 or libxcb-cursor0 is needed to load the Qt xcb platform plugin.\\
qt.qpa.plugin:~Could not load the Qt platform plugin "xcb" in "" even though it was found.\\
This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.\\ 
Available platform plugins are: xcb, wayland, minimal.\\
\\
Aborted (core dumped)}\\

解决方案:~安装\textrm{libxcb}库\\
\textrm{sudo apt-get install libxcb-cursor}

\textrm{VMD}的安装
\begin{itemize}
	\item \textrm{tar -xvzf}解压
	\item 进入安装目录\textrm{./configure LINUXAMD64}
	\item 进入源代码目录\textrm{cd~src}
	\item 用\textrm{sudo}执行\textrm{make~install}:~\textrm{sudo~make~install}
\end{itemize}
\section{\rm{wine}安装及使用}
\begin{itemize}
	\item 运行64位体系结构的系统需要启用32位体系结构:\\
		\textrm{sudo~dpkg~-\/-add-architecture~i386}
	\item 下载存储库密钥并将其添加到系统中:\\
		\textrm{wget~-qO~-~\url{https://dl.winehq.org/wine-builds/winehq.key}~|~sudo~apt-key~add~-~}
	\item 使用以下命令在系统中启用\textrm{Wine~apt}存储库:\\
		\textrm{sudo~apt-add-repository~'deb~\url{https://dl.winehq.org/wine-builds/ubuntu/}~focal main'}
	\item 在\textrm{Ubuntu~20.04}上安装\textrm{Wine}:\\
		您的系统已准备好安装\textrm{Wine}。使用以下命令从\textrm{apt}信息库安装\textrm{Wine}软件包。该\textrm{-\/-install-recommends}选项将在您的\textrm{Ubuntu~20.04}系统上安装\textrm{winehq}稳定版本的所有推荐软件包\\
		\textrm{sudo~apt-get~update}\\
		\textrm{sudo~apt~install~-\/-install-recommends~winehq-stable}\\
		在任何情况下，您在安装过程中都会遇到未满足依赖性的错误，请使用以下命令在\textrm{Ubuntu}上使用\textrm{aptitude}安装\textrm{wine}\\
		\textrm{sudo~apt~install~aptitude}\\
		\textrm{sudo~aptitude~install~winehq-stable}\\
		这将在\textrm{Ubuntu~20.04}系统上安装Wine和所有需要的软件包\\
	\item 测试\textrm{Wine}版本\\
		在您的\textrm{Ubuntu}系统上，\textrm{Wine}的安装已经成功完成。使用以下命令检查您系统上安装的\textrm{Wine}版本:\\
		\textrm{wine -\/-version}
	\item \textrm{Wine}的使用\\
		要使用\textrm{Wine}，我们需要登录到\textrm{Ubuntu}系统的\textrm{GUI}桌面。然后在你的系统上下载一个像\textrm{PuTTY}这样的\textrm{windows .exe}文件，然后用\textrm{Wine}打开它，或者使用以下命令:\\
		\textrm{wine~putty.exe}
		你也可以通过右键点击应用程序，然后点击打开\textrm{Wine~Windows}程序来启动。
\end{itemize}

\section{\rm{forti~VPN~client}的安装}
\begin{itemize}
	\item 要从\textrm{Fortinet~Ubuntu}存储库安装\textrm{Fortinet~VPN}，首先需要安装存储库\textrm{GPG}签名密钥:\\
		\textrm{wget~-O~-~\url{https://repo.fortinet.com/repo/ubuntu/DEB-GPG-KEY}~|~sudo~apt-key~add~-~}
	\item 创建\textrm{Fortinet~Ubuntu}存储库:\\ 
		\textrm{echo~"deb~[arch=amd64]~\url{https://repo.fortinet.com/repo/ubuntu/}~/bionic multiverse"~|~sudo~tee~/etc/apt/sources.list.d/fortinet.list}
	\item 更新软件包存储库:\\
		\textrm{apt update}
	\item 检查可用版本:\\
		\textrm{apt-cache~policy~forticlient}
\end{itemize}
%-------------------The Figure Of The Paper------------------
%\begin{figure}[h!]
%\centering
%\includegraphics[height=3.35in,width=2.85in,viewport=0 0 400 475,clip]{PbTe_Band_SO.eps}
%\hspace{0.5in}
%\includegraphics[height=3.35in,width=2.85in,viewport=0 0 400 475,clip]{EuTe_Band_SO.eps}
%\caption{\small Band Structure of PbTe (a) and EuTe (b).}%(与文献\cite{EPJB33-47_2003}图1对比)
%\label{Pb:EuTe-Band_struct}
%\end{figure}

%-------------------The Equation Of The Paper-----------------
%\begin{equation}
%\varepsilon_1(\omega)=1+\frac2{\pi}\mathscr P\int_0^{+\infty}\frac{\omega'\varepsilon_2(\omega')}{\omega'^2-\omega^2}d\omega'
%\label{eq:magno-1}
%\end{equation}

%\begin{equation} 
%\begin{split}
%\varepsilon_2(\omega)&=\frac{e^2}{2\pi m^2\omega^2}\sum_{c,v}\int_{BZ}d{\vec k}\left|\vec e\cdot\vec M_{cv}(\vec k)\right|^2\delta [E_{cv}(\vec k)-\hbar\omega] \\
% &= \frac{e^2}{2\pi m^2\omega^2}\sum_{c,v}\int_{E_{cv}(\vec k=\hbar\omega)}\left|\vec e\cdot\vec M_{cv}(\vec k)\right|^2\dfrac{dS}{\nabla_{\vec k}E_{cv}(\vec k)}
% \end{split}
%\label{eq:magno-2}
%\end{equation}

%-------------------The Table Of The Paper----------------------
%\begin{table}[!h]
%\tabcolsep 0pt \vspace*{-12pt}
%\caption{The representative $\vec k$ points contributing to $\sigma_2^{xy}$ of interband transition in EuTe around 2.5 eV.}
%\label{Table-EuTe_Sigma}
%\begin{minipage}{\textwidth}
%%\begin{center}
%\centering
%\def\temptablewidth{1.01\textwidth}
%\rule{\temptablewidth}{1pt}
%\begin{tabular*} {\temptablewidth}{@{\extracolsep{\fill}}cccccc}

%-------------------------------------------------------------------------------------------------------------------------
%&Peak (eV)  & {$\vec k$}-point            &Band{$_v$} to Band{$_c$}  &Transition Orbital
%Components\footnote{波函数主要成分后的括号中，$5s$、$5p$和$5p$、$4f$、$5d$分别指碲和铕的原子轨道。} &Gap (eV)   \\ \hline
%-------------------------------------------------------------------------------------------------------------------------
%&2.35       &(0,0,0)         &33$\rightarrow$34    &$4f$(31.58)$5p$(38.69)$\rightarrow$$5p$      &2.142   \\% \cline{3-7}
%&       &(0,0,0)         &33$\rightarrow$34    &$4f$(31.58)$5p$(38.69)$\rightarrow$$5p$      &2.142   \\% \cline{3-7}
%-------------------------------------------------------------------------------------------------------------------------

%\end{tabular*}
%\rule{\temptablewidth}{1pt}\\
%%\end{center}
%\end{minipage}
%\end{table}

%-------------------The Long Table Of The Paper--------------------
%\begin{small}
%%\begin{minipage}{\textwidth}
%%\begin{longtable}[l]{|c|c|cc|c|c|} %[c]指定长表格对齐方式
%\begin{longtable}[c]{|c|c|p{1.9cm}p{4.6cm}|c|c|}
%\caption{Assignment for the peaks of EuB$_6$}
%\label{tab:EuB6-1}\\ %\\长表格的caption中换行不可少
%\hline
%%
%--------------------------------------------------------------------------------------------------------------------------------
%\multicolumn{2}{|c|}{\bfseries$\sigma_1(\omega)$谱峰}&\multicolumn{4}{c|}{\bfseries部分重要能带间电子跃迁\footnotemark}\\ \hline
%\endfirsthead
%--------------------------------------------------------------------------------------------------------------------------------
%%
%\multicolumn{6}{r}{\it 续表}\\
%\hline
%--------------------------------------------------------------------------------------------------------------------------------
%标记 &峰位(eV) &\multicolumn{2}{c|}{有关电子跃迁} &gap(eV)  &\multicolumn{1}{c|}{经验指认} \\ \hline
%\endhead
%--------------------------------------------------------------------------------------------------------------------------------
%%
%\multicolumn{6}{r}{\it 续下页}\\
%\endfoot
%\hline
%--------------------------------------------------------------------------------------------------------------------------------
%%
%%\hlinewd{0.5$p$t}
%\endlastfoot
%--------------------------------------------------------------------------------------------------------------------------------
%%
%% Stuff from here to \endlastfoot goes at bottom of last page.
%%
%--------------------------------------------------------------------------------------------------------------------------------
%标记 &峰位(eV)\footnotetext{见正文说明。} &\multicolumn{2}{c|}{有关电子跃迁\footnotemark} &gap(eV) &\multicolumn{1}{c|}{经验指认\upcite{PRB46-12196_1992}}\\ \hline
%--------------------------------------------------------------------------------------------------------------------------------
%
%     &0.07 &\multicolumn{2}{c|}{电子群体激发$\uparrow$} &--- &电子群\\ \cline{2-5}
%\raisebox{2.3ex}[0pt]{$\omega_f$} &0.1 &\multicolumn{2}{c|}{电子群体激发$\downarrow$} &--- &体激发\\ \hline
%--------------------------------------------------------------------------------------------------------------------------------
%
%     &1.50 &\raisebox{-2ex}[0pt][0pt]{20-22(0,1,4)} &2$p$(10.4)4$f$(74.9)$\rightarrow$ &\raisebox{-2ex}[0pt][0pt]{1.47} &\\%\cline{3-5}
%     &1.50$^\ast$ & &2$p$(17.5)5$d_{\mathrm E}$(14.0)$\uparrow$ & &4$f$$\rightarrow$5$d_{\mathrm E}$\\ \cline{3-5}
%     \raisebox{2.3ex}[0pt][0pt]{$a$} &(1.0$^\dagger$) &\raisebox{-2ex}[0pt][0pt]{20-22(1,2,6)} &\raisebox{-2ex}[0pt][0pt]{4$f$(89.9)$\rightarrow$2$p$(18.7)5$d_{\mathrm E}$(13.9)$\uparrow$}\footnotetext{波函数主要成分后的括号中，2$s$、2$p$和5$p$、4$f$、5$d$、6$s$分别指硼和铕的原子轨道；5$d_{\mathrm E}$、5$d_{\mathrm T}$分别指铕的(5$d_{z^2}$，5$d_{x^2-y^2}$和5$d_{xy}$，5$d_{xz}$，5$d_{yz}$)轨道，5$d_{\mathrm{ET}}$(或5$d_{\mathrm{TE}}$)则指5个5$d$轨道成分都有，成分大的用脚标的第一个字母标示；2$ps$(或2$sp$)表示同时含有硼2$s$、2$p$轨道成分，成分大的用第一个字母标示。$\uparrow$和$\downarrow$分别标示$\alpha$和$\beta$自旋电子跃迁。} &\raisebox{-2ex}[0pt][0pt]{1.56} &激子跃迁。 \\%\cline{3-5}
%     &(1.3$^\dagger$) & & & &\\ \hline
%--------------------------------------------------------------------------------------------------------------------------------

%     & &\raisebox{-2ex}[0pt][0pt]{19-22(0,0,1)} &2$p$(37.6)5$d_{\mathrm T}$(4.5)4$f$(6.7)$\rightarrow$ & & \\\nopagebreak %\cline{3-5}
%     & & &2$p$(24.2)5$d_{\mathrm E}$(10.8)4$f$(5.1)$\uparrow$ &\raisebox{2ex}[0pt][0pt]{2.78} &a、b、c峰可能 \\ \cline{3-5}
%     & &\raisebox{-2ex}[0pt][0pt]{20-29(0,1,1)} &2$p$(35.7)5$d_{\mathrm T}$(4.8)4$f$(10.0)$\rightarrow$ & &包含有复杂的\\ \nopagebreak%\cline{3-5}
%     &2.90 & &2$p$(23.2)5$d_{\mathrm E}$(13.2)4$f$(3.8)$\uparrow$ &\raisebox{2ex}[0pt][0pt]{2.92} &强激子峰。$^{\ast\ast}$\\ \cline{3-5}
%$b$  &2.90$^\ast$ &\raisebox{-2ex}[0pt][0pt]{19-22(0,1,1)} &2$p$(33.9)4$f$(15.5)$\rightarrow$ & &B2$s$-2$p$的价带 \\ \nopagebreak%\cline{3-5}
%     &3.0 & &2$p$(23.2)5$d_{\mathrm E}$(13.2)4$f$(4.8)$\uparrow$ &\raisebox{2ex}[0pt][0pt]{2.94} &顶$\rightarrow$B2$s$-2$p$导\\ \cline{3-5}
%     & &12-15(0,1,2) &2$p$(39.3)$\rightarrow$2$p$(25.2)5$d_{\mathrm E}$(8.6)$\downarrow$ &2.83 &带底跃迁。\\ \cline{3-5}
%     & &14-15(1,1,1) &2$p$(42.5)$\rightarrow$2$p$(29.1)5$d_{\mathrm E}$(7.0)$\downarrow$ &2.96 & \\\cline{3-5}
%     & &13-15(0,1,1) &2$p$(40.4)$\rightarrow$2$p$(28.9)5$d_{\mathrm E}$(6.6)$\downarrow$ &2.98 & \\ \hline
%--------------------------------------------------------------------------------------------------------------------------------
%%\hline
%%\hlinewd{0.5$p$t}
%\end{longtable}
%%\end{minipage}{\textwidth}
%%\setlength{\unitlength}{1cm}
%%\begin{picture}(0.5,2.0)
%%  \put(-0.02,1.93){$^{1)}$}
%%  \put(-0.02,1.43){$^{2)}$}
%%\put(0.25,1.0){\parbox[h]{14.2cm}{\small{\\}}
%%\put(-0.25,2.3){\line(1,0){15}}
%%\end{picture}
%\end{small}


%\section{\rm{slurm}的安装}
\section{\rm{R}语言及\textrm{Rstudio-server}的安装}
安装\textrm{R}语言\\ 
\# 更新软件包列表:~\\
\textrm{sudo apt update -qq}\\
\# 安装帮助程序包:~\\
\textrm{sudo apt install -\/-no-install-recommends software-properties-common dirmngr}\\
\# 添加密钥:~\\
\textrm{wget -qO- \url{https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc} | sudo tee -a /etc/apt/trusted.gpg.d/cran\_ubuntu\_key.asc}\\
\# 添加R4.0的镜像源:~
\textrm{sudo add-apt-repository "deb \url{https://cloud.r-project.org/bin/linux/ubuntu \$(lsb\_release -cs)-cran40/}"}\\
\# 安装\textrm{R}:\\
\textrm{sudo apt install -y r-base-core}

以下命令分别修改\textrm{Bioconductor}和\textrm{CRAN}的默认镜像源（方便以后安装\textrm{R}包）
\textrm{echo -e 'options(BioC\_mirror="\textrm{https://mirrors.tuna.tsinghua.edu.cn/bioconductor}")\noptions("repos" = c(CRAN="\textrm{https://mirrors.tuna.tsinghua.edu.cn/CRAN/}"))' >> ~/.Rprofile}

\textcolor{red}{打开\textrm{R}，安装\textrm{ggplot2}包}:~\\
\textrm{install.packages("ggplot2")}

\textrm{RStudio-Server}安装:\\
\textrm{wget -c \url{http://download2.rstudio.org/sever/bionic/amd64/rstudio-server-2023.03.0-386-amd64.deb}}\\
\textrm{sudo apt-get install -y gdebi-core}\\
\textrm{sudo gdebi rstudio-server-2023.03.0-386-amd64.deb}

打开浏览器，输入\textrm{IP}:端口（默认端口为\textrm{8787}），输入用户名密码

\section{\rm{yum}安装\textrm{rpm}}
\textrm{Centos}非\textrm{root}用户(普通用户)安装\textrm{rpm}包

\textrm{rpm2cpio xxxx.rpm | cpio -idvm}\\
这样会把软件安装在当前目录下
\end{document}

\section{\rm{Docker}}
\textrm{Ubuntu}下\textrm{Docker}的安装:\\
\textrm{sudo apt-get update}\\
\textrm{sudo apt-get install ca-certificates curl gnupg}\\
\textrm{sudo install -m 0755 -d /etc/apt/keyrings}\\
\textrm{curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg -\/-dearmor -o /etc/apt/keyrings/docker.gpg}\\
\textrm{sudo chomd a+r /etc/apt/keyrings/docker.gpg}

添加\textrm{docker}在线安装源:\\
``deb [arch=\$(dpkg -\/-print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \backslash \\
\$(. /etc/os-release \&\& echo "\$VERSION_CODENAME") stable" | \backslash \\
sudo tee /etc/apt/source.list.d/docker.list > /dev/null

更新软件源:\\
\textrm{sudo apt-get update}\\

安装\textrm{docker}\\
\textrm{sudo apt-get install docker-ce docker-ce-cil containerd.io docker-buildx-plugin docker-compose-plugin}\\

验证\textrm\{docker}安装结果\\
\textrm{sudo docker run hello-world}


配置国内源地址:\\
\textrm{vim /etc/docker/daemon.json}

\textrm{\{"registry-mirrors" : ["https://mirror.ccs.tencentyun.com","http://registry.docker-cn.com","http://docker.mirrors.ustc.edu.cn","http://hub-mirror.c.163.com"],"insecure-registries" : ["registry.docker-cn.com","docker.mirrors.ustc.edu.cn"],"debug" : true,"experimental" : true\\
\}}\\

重启\textrm{docker}\\

\textrm{systemctl restart docker.service}

基础\textrm{docker}命令\\
\textrm{docker -v} \#查看版本\\
\textrm{systemctl start docker} \#启动\textrm{docker}\\
\textrm{systemctl stop docker}  \#停止\textrm{docker}\\
\textrm{systemctl restart docker} \#重启\textrm{docker}\\
\textrm{systemctl status docker}  \#查看\textrm{docker}状态\\
\textrm{systemctl enable docker} \#开机启动\\

\textrm{Docker}的运行:\\
\textrm{docker run -v ~/Softwares/WIEN2k\_18.2:/home -w /home -it softwarei\_wien2k /bin/bash}\\
\textrm{ubuntu}可视化界面\\
\textrm{docker pull dorowu/ubuntu-desktop-lxde-vnc}\\
\textrm{docker run -\/-name vnc_test -p 6080:80 -v source\_dir:object\_dir -v /dev/shm:/dev/shm -w /home dorowu/ubuntu-desktop-lxde-vnc}

\textrm{/dev/shm}~目录，\textrm{shm}~代表共享内存。\textrm{/dev/shm}~是一个临时文件系统~(操作磁盘中的文件一样来将读写内存，换言之，用文件读写的语法来操作\textrm{/dev/shm/a.txt}，但是这个文件本质是存在内存里的，所以读写速度会非常快)。有了\textrm{/dev/shm}，可以让一个进程非常高效地存取一些临时文件，或者让多个进程非常高效的“共享内存”。这种“进程间快速共享内存”的能力对于很多机器学习框架来说非常有用。

\subsection{\rm{docker}镜像无法使用解决方案}
国内\textrm{docker}镜像源无法使用，添加镜像的步骤
\begin{enumerate}
	\item 配置镜像加速\\
\textrm{sudo~tee~/etc/docker/daemon.json~<<EOF\\
\{\\
	\textrm{"registry-mirrors":~["https://do.nark.eu.org"]}\\
\}\\
\textrm{EOF}

\item 重启加载\textrm{Docker}\\
	\textrm{sudor~systemctl~daemon-reload}\\
	\textrm{sudo~systemctl~restart~docker}

\item 镜像拉取操作\\
	\begin{itemize}
		\item 原拉取镜像命令:\\

			\textrm{docker~pull~xxx:latest}
		\item 加速拉取镜像命令:\\
			\textrm{docker~pull~\textcolor{bule}{do.nark.eu.org/}xxx:latest}
	\end{itemize}
\end{enumerate}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%--------------------------------------------------------------------------The Biblography of The Paper-----------------------------------------------------------------%
%\newpage																				%
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%\begin{thebibliography}{99}																		%
%%\bibitem{PRL58-65_1987}H.Feil, C. Haas, {\it Phys. Rev. Lett.} {\bf 58}, 65 (1987).											%
%\end{thebibliography}																			%
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%																					%
\phantomsection\addcontentsline{toc}{section}{Bibliography}	 %直接调用\addcontentsline命令可能导致超链指向不准确,一般需要在之前调用一次\phantomsection命令加以修正	%
\bibliography{ref/Myref}																			%
\bibliographystyle{ref/mybib}																		%
%  \nocite{*}																				%
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------%

\clearpage     %\end{CJK} 前加上\clearpage是CJK的要求
